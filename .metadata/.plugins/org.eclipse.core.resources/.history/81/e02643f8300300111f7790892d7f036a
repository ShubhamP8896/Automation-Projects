package LinkedIn_Test_Classes;

import java.io.IOException;
import java.time.Duration;
import java.util.NoSuchElementException;

import org.openqa.selenium.Alert;
import org.openqa.selenium.NoAlertPresentException;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebDriverException;
import org.openqa.selenium.chrome.ChromeDriver;
import org.testng.ITestResult;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;

import LinkedIn_POM_Classes.LoginPage;
import LinkedIn_POM_Classes.Rec_JobListPage_POM_Class;
import LinkedIn_Utility_Classes.DriverFactory;
import LinkedIn_Utility_Classes.LinkedIn_Excel_Data_UtilityClass;
import LinkedIn_Utility_Classes.LinkedIn_Take_Screenshot_UtilityClass;

public class A001_BaseTestClass_Rec_Design 
{
	public static WebDriver getDriver()
	{
		return DriverFactory.getDriver();
	}

    @BeforeMethod
    public void SetUp() throws IOException 
    {
        navigateToUrl();
        performLogin();
    }

    private void navigateToUrl() 
    {
    	getDriver().get("https://design.sniperai.com/");
        System.out.println("URL Opened Successfully");
        getDriver().manage().timeouts().implicitlyWait(Duration.ofSeconds(20));
    }

    private void performLogin() throws IOException 
    {
        LoginPage LP = new LoginPage(getDriver());
        
        LP.fetchRecruiterCredentials(1);
        
        LP.RCSendUsername();
        System.out.println("Recruiter Username Added");
        LP.RCSendPassword();
        System.out.println("Recruiter Password Added");
        LP.UserTypeR();
        System.out.println("Recruiter user type selected");
        LP.RememberMe();
        System.out.println("Remember Me checkbox is selected");
        LP.LoginButton();
        System.out.println("Recruiter Clicked on Login Button");

        handlePossibleAlert();
    }

    private void handlePossibleAlert() throws IOException {
        try {
            Alert alert = getDriver().switchTo().alert();
            String alertMessage = alert.getText();
            alert.accept();
            System.out.println("Alert message: " + alertMessage);
//          Excel_Data_UtilityClass.writeResult("Test case failed - Incorrect credentials. Alert message: " + alertMessage);
        } catch (NoAlertPresentException e) {
            System.out.println("No alert present on the page.");
        } catch (NoSuchElementException e) {
            System.out.println("No web element found on the page.");
            LinkedIn_Excel_Data_UtilityClass.writeResult("No web element found on the page.");
        } catch (WebDriverException e) {
            System.out.println("WebDriverException occurred: " + e.getMessage());
            LinkedIn_Excel_Data_UtilityClass.writeResult("WebDriverException occurred: " + e.getMessage());
        } catch (Exception e) {
            System.out.println("An exception occurred: " + e.getMessage());
            LinkedIn_Excel_Data_UtilityClass.writeResult("An exception occurred: " + e.getMessage());
        }
    }

    @AfterMethod
    public void teardown(ITestResult result) 
    {
        try 
        {
            if (result.getStatus() == ITestResult.FAILURE) 
            {
                LinkedIn_Take_Screenshot_UtilityClass.takeScreenshot(result.getName() + "_Failure_Screenshot");
                System.out.println("Failure Screenshot taken Successfully");
            } 
            else 
            {
                LinkedIn_Take_Screenshot_UtilityClass.takeScreenshot(result.getName());
                System.out.println("Success Screenshot taken Successfully");
            }
        } 
        catch (Exception e) 
        {
            System.out.println("Exception while taking screenshot: " + e.getMessage());
        } 
        finally 
        {
            if (getDriver() != null) 
            {
                logoutAndQuitDriver();
            }
        }
    }

//    Recruiter Module Logout code
    private void logoutAndQuitDriver() 
    {
    	Rec_JobListPage_POM_Class RecJobListPage = new Rec_JobListPage_POM_Class (getDriver());
    	RecJobListPage.Sidebar();
    	RecJobListPage.Signout();
    	getDriver().quit();
    }
}
