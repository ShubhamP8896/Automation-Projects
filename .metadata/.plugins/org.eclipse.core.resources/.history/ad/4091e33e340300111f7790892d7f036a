package LinkedIn_Test_Classes;

import java.io.IOException;
import java.time.Duration;

import org.openqa.selenium.By;
import org.openqa.selenium.TimeoutException;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.Test;

import LinkedIn_POM_Classes.Rec_JobListPage_POM_Class;
import LinkedIn_Utility_Classes.LinkedIn_Excel_Data_UtilityClass;


public class TC001_Fetch_LinkedIn_Candidates extends A001_BaseTestClass_Rec_Design
{
	@Test
	public void JobListPageActions_Rec() throws InterruptedException, IOException
	{
//		JobList page POM class object to perform actions on job list page
		Rec_JobListPage_POM_Class JobListPage = new Rec_JobListPage_POM_Class();
		
		JobListPage.Alljobs();
		System.out.println("Clicked on all jobs");
		
		JobListPage.JobReqColumnFilter();
		System.out.println("Clicked on Job req Column filter icon");
		
		JobListPage.JobReqSearchField();
		System.out.println("Added Input in the search field of Job req ID");
		
		JobListPage.JobReqColumnFilterSearch();
		System.out.println("Clicked on Job req Column filter Search icon");
		
		Thread.sleep(2000);
		
		JobListPage.EditJobLinkedIn1();
		System.out.println("Clicked Edit Job icon");
		
		JobListPage.JobBoard();
		System.out.println("Clicked on Job Boarb");
		
		JobListPage.UpdateJob();
		System.out.println("Clicked on Update Job");
		
		// âœ… Notification wait with timeout handling
		WebDriverWait wait = new WebDriverWait(getDriver(), Duration.ofSeconds(75));
		String actualResult;	
		
		try {
			WebElement notification = wait.until(ExpectedConditions.visibilityOfElementLocated(
					By.xpath("//span[@id='notificationText']")));

			String notificationText = notification.getText();
			System.out.println("Notification received: " + notificationText);

			if (notificationText.contains("Great news! Sniper AI has successfully fetched LinkedIn candidates for Job Req Id: LinkedIn-1.\r\n"
					+ "To view the candidates, please click here"))
			{
				actualResult = "Candidates are found and fetched successfully";
			} 
			else if (notificationText.contains("No candidates found for Job Req Id: LinkedIn-1 .\r\n"
					+ "Sometimes, the candidate pool may not have a perfect match for your requirements.")) 
			{
				actualResult = "Candidates are not found for this search";
			} else 
			{
				actualResult = "Notification received: " + notificationText;
			}
		} catch (TimeoutException e) 
		{
			actualResult = "Test case failed: No notification found within timeout";
			System.out.println("No notification appeared within 60 seconds.");
		}

		LinkedIn_Excel_Data_UtilityClass.writeResult(actualResult);

		if (actualResult.contains("failed")) {
			Assert.fail(actualResult);
		}

	}

}
